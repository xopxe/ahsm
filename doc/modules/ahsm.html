<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>ahsm</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Functions">Functions</a></li>
<li><a href="#Fields">Fields</a></li>
<li><a href="#Data_structures">Data structures </a></li>
</ul>


<h2>Modules</h2>
<ul class="nowrap">
  <li><strong>ahsm</strong></li>
  <li><a href="../modules/tools.to_dot.html">tools.to_dot</a></li>
  <li><a href="../modules/tools.debug_plain.html">tools.debug_plain</a></li>
  <li><a href="../modules/tools.cb_list.html">tools.cb_list</a></li>
</ul>
<h2>Scripts</h2>
<ul class="nowrap">
  <li><a href="../scripts/run.lua.html">run.lua</a></li>
  <li><a href="../scripts/run_to_dot.lua.html">run_to_dot.lua</a></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/README.md.html">README</a></li>
</ul>
<h2>Examples</h2>
<ul class="nowrap">
  <li><a href="../examples/composite.lua.html">composite.lua</a></li>
  <li><a href="../examples/helloworld.lua.html">helloworld.lua</a></li>
  <li><a href="../examples/timeout_change.lua.html">timeout_change.lua</a></li>
</ul>

</div>

<div id="content">

<h1>Module <code>ahsm</code></h1>
<p>ahsm Hierarchical State Machine.</p>
<p> ahsm is a very small implementation of Hierararchical State Machines,
 also known as Statecharts. It's written in Lua, with no external
 dependencies, and in a single file. Can be run on platforms as small as
 a microcontroler.</p>
    <h3>Usage:</h3>
    <ul>
        <pre class="example">local ahsm = require &apos;ahsm&apos;
</pre>
    </ul>


<h2><a href="#Functions">Functions</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#get_time">get_time ()</a></td>
	<td class="summary">Function used to get current time.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#state">state (state_s)</a></td>
	<td class="summary">Initialize a state.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#transition">transition (transition_s)</a></td>
	<td class="summary">Initialize a transition.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#init">init (root)</a></td>
	<td class="summary">Create a hsm.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#hsm.get_events">hsm.get_events (evqueue)</a></td>
	<td class="summary">Callback for pulling events.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#hsm.send_event">hsm.send_event (ev)</a></td>
	<td class="summary">Push new event to the hsm.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#hsm.queue_event">hsm.queue_event (ev)</a></td>
	<td class="summary">Queue new event to the hsm.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#hsm.step">hsm.step (count)</a></td>
	<td class="summary">Step trough the hsm.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#hsm.loop">hsm.loop ()</a></td>
	<td class="summary">Loop trough the hsm.</td>
	</tr>
</table>
<h2><a href="#Fields">Fields</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#debug">debug</a></td>
	<td class="summary">Debug print function.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#EV_ANY">EV_ANY</a></td>
	<td class="summary">When used in the <a href="../modules/ahsm.html#transition_s">transition_s</a><code>.events</code> field will match any event.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#EV_TIMEOUT">EV_TIMEOUT</a></td>
	<td class="summary">Event reported to <a href="../modules/ahsm.html#transition_s">transition_s</a><code>.effect</code> when a transition is made due
 to a timeout.</td>
	</tr>
</table>
<h2><a href="#Data_structures">Data structures </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#state_s">state_s</a></td>
	<td class="summary">State specification.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#transition_s">transition_s</a></td>
	<td class="summary">Transition specification.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Functions"></a>Functions</h2>

    <dl class="function">
    <dt>
    <a name = "get_time"></a>
    <strong>get_time ()</strong>
    </dt>
    <dd>
    Function used to get current time.
 Replace with whatever your app uses. Must return a number. This is used when
 computing timeouts for transitions.
 Defaults to os.time.







</dd>
    <dt>
    <a name = "state"></a>
    <strong>state (state_s)</strong>
    </dt>
    <dd>
    Initialize a state.
 Converts a state specfification into a state.
 The state has a EV_DONE field which is an event triggered on state
 completion.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">state_s</span>
         state specificatios (see <a href="../modules/ahsm.html#state_s">state_s</a>).
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        the initilized state
    </ol>




</dd>
    <dt>
    <a name = "transition"></a>
    <strong>transition (transition_s)</strong>
    </dt>
    <dd>
    Initialize a transition.
 Converts a transition specification into a transition table.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">transition_s</span>
         transition specificatios (see <a href="../modules/ahsm.html#transition_s">transition_s</a>).
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        the initilized transition
    </ol>




</dd>
    <dt>
    <a name = "init"></a>
    <strong>init (root)</strong>
    </dt>
    <dd>
    Create a hsm.
 Constructs and initializes an hsm from a root state.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">root</span>
         the root state, must be a composite.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        initialized hsm
    </ol>




</dd>
    <dt>
    <a name = "hsm.get_events"></a>
    <strong>hsm.get_events (evqueue)</strong>
    </dt>
    <dd>
    Callback for pulling events.
 If provided, this function will be called from inside the <a href="../modules/ahsm.html#hsm.step">step</a> call
 so new events can be added.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">evqueue</span>
         an array where new events can be added.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "hsm.send_event"></a>
    <strong>hsm.send_event (ev)</strong>
    </dt>
    <dd>
    Push new event to the hsm.
 The event will be queued, and then the machine will be looped using
 <a href="../modules/ahsm.html#hsm.loop">loop</a>. <br/>
 BEWARE: if this is called from a callback from C side, will cause a core
 panic. In this scenario you must use <a href="../modules/ahsm.html#hsm.queue_event">queue_event</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">ev</span>
         an event. Can be of any type except nil.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "hsm.queue_event"></a>
    <strong>hsm.queue_event (ev)</strong>
    </dt>
    <dd>
    Queue new event to the hsm.
 The queued messages will be processed when machine is stepped using
 <a href="../modules/ahsm.html#hsm.step">step</a> or <a href="../modules/ahsm.html#hsm.loop">loop</a>. Also, see <a href="../modules/ahsm.html#hsm.send_event">send_event</a>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">ev</span>
         an event. Can be of any type except nil.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "hsm.step"></a>
    <strong>hsm.step (count)</strong>
    </dt>
    <dd>
    Step trough the hsm.
 A single step will consume all pending events, and do a round evaluating
 available doo() functions on all active states. This call finishes as soon
 as the cycle count is reached or the hsm becomes idle.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">count</span>
         maximum number of cycles to perform. Defaults to 1
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

         the idle status, and the next impending expiration time if
 available. Being idle means that all events have been consumed and no
 doo() function is pending to be run. The expiration time indicates there
 is a transition with timeout waiting.
    </ol>




</dd>
    <dt>
    <a name = "hsm.loop"></a>
    <strong>hsm.loop ()</strong>
    </dt>
    <dd>
    Loop trough the hsm.
 Will step the machine until it becomes idle. When this call returns means
 there's no actions to be taken immediatelly.



    <h3>Returns:</h3>
    <ol>

        If available, the time of the closests pending timeout
 on a transition
    </ol>




</dd>
</dl>
    <h2 class="section-header "><a name="Fields"></a>Fields</h2>

    <dl class="function">
    <dt>
    <a name = "debug"></a>
    <strong>debug</strong>
    </dt>
    <dd>
    Debug print function.
 If provided, this function will be called to print debug information.
 It must be set before calling <a href="../modules/ahsm.html#init">init</a>. The debug will try to get friendly
 names for events, transitions and states from the exported names (see <code>states</code>,
 <code>transitions</code> and <code>events</code> fields from <a href="../modules/ahsm.html#state_s">state_s</a>), or a <code>_name</code> field.






    <h3>Usage:</h3>
    <ul>
        <pre class="example">ahsm.<span class="global">debug</span> = <span class="global">print</span></pre>
    </ul>

</dd>
    <dt>
    <a name = "EV_ANY"></a>
    <strong>EV_ANY</strong>
    </dt>
    <dd>
    When used in the <a href="../modules/ahsm.html#transition_s">transition_s</a><code>.events</code> field will match any event.







</dd>
    <dt>
    <a name = "EV_TIMEOUT"></a>
    <strong>EV_TIMEOUT</strong>
    </dt>
    <dd>
    Event reported to <a href="../modules/ahsm.html#transition_s">transition_s</a><code>.effect</code> when a transition is made due
 to a timeout.







</dd>
</dl>
    <h2 class="section-header has-description"><a name="Data_structures"></a>Data structures </h2>

          <div class="section-description">
           Main structures used to describe a hsm.
          </div>
    <dl class="function">
    <dt>
    <a name = "state_s"></a>
    <strong>state_s</strong>
    </dt>
    <dd>
    State specification.
 A state can be either leaf or composite. A composite state has a hsm
 embedded, defined by the <code>states</code>, <code>transitions</code> and <code>initial</code> fields. When a
 compodite state is activated the embedded hsm is started from the <code>initial</code>
 state. The activity of a state must be provided in the <code>entry</code>, <code>exit</code> and <code>doo</code>
 fields.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">entry</span>
         an optional function to be called on entering the state.
        </li>
        <li><span class="parameter">exit</span>
         an optional function to be called on leaving the state.
        </li>
        <li><span class="parameter">doo</span>
         an optional function that will be called when the state is
 active. If this function returns true, it will be polled again. If
 returns false, it is considered as completed.
        </li>
        <li><span class="parameter">EV_DONE</span>
         This field is created when calling <a href="../modules/ahsm.html#state">state</a>, and is an
 event emitted when the <code>doo()</code> function is completed, or immediatelly if
 no <code>doo()</code> function is provided.
        </li>
        <li><span class="parameter">states</span>
         When the state is a composite this table's values are the
 states of the embedded hsm. Keys can be used to provide a name.
        </li>
        <li><span class="parameter">transitions</span>
         When the state is a composite this table's values are
 the transitions of the embedded hsm. Keys can be used to provide a name.
        </li>
        <li><span class="parameter">initial</span>
         This is the initial state of the embedded.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "transition_s"></a>
    <strong>transition_s</strong>
    </dt>
    <dd>
    Transition specification.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">src</span>
         source state.
        </li>
        <li><span class="parameter">dst</span>
         destination state.
        </li>
        <li><span class="parameter">events</span>
         table where the values are the events that trigger the
 transition. Can be supressed by the guard function
        </li>
        <li><span class="parameter">guard</span>
         if provided, when the transition is triggered this function
 will be evaluated with the event as parameter. If returns a true value
 the transition is made.
        </li>
        <li><span class="parameter">effect</span>
         this funcion of transition traversal, with the triggering
 event as parameter.
        </li>
        <li><span class="parameter">timeout</span>
         If provided, this number is used as timeout for time
 traversal. After timeout time units spent in the souce state the transition
 will be triggered with the <a href="../modules/ahsm.html#EV_TIMEOUT">EV_TIMEOUT</a> event as parameter. Uses the
 <a href="../modules/ahsm.html#get_time">get_time</a> to read the system's time.
        </li>
    </ul>





</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2019-04-27 17:58:58 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
